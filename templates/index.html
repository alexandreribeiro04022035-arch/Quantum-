<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Quantum IA</title>

<style>
body {
    background-color: #000;
    color: #FFD700;
    font-family: 'Courier New', monospace;
    margin: 20px;
}
h2 {
    color: #FFD700;
    border-bottom: 2px solid #FFD700;
    padding-bottom: 10px;
}
textarea, input {
    background: #111;
    color: #FFD700;
    border: 1px solid #FFD700;
    padding: 10px;
    width: 300px;
}
button {
    background: #111;
    color: #FFD700;
    border: 1px solid #FFD700;
    padding: 10px 20px;
    cursor: pointer;
}
button:hover {
    background: #FFD700;
    color: #000;
}
pre {
    background: #111;
    color: #FFD700;
    border: 1px solid #FFD700;
    padding: 15px;
    margin-top: 20px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login">
  <h2>Login</h2>
  <input id="email" placeholder="Email"><br><br>
  <input id="senha" type="password" placeholder="Senha"><br><br>
  <button onclick="login()">Entrar</button>
</div>

<!-- APP -->
<div id="app" style="display:none">
  <h2>Comando para IA</h2>
  <textarea id="cmd" rows="6"></textarea><br><br>
  <button onclick="enviar()">Enviar</button>
  <pre id="resp"></pre>
</div>

<script>
// SUPABASE
const SUPABASE_URL = "https://lpkhscatjrllfscqmxka.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxwa2hzY2F0anJsbGZzY3FteGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1NzU3MjYsImV4cCI6MjA3OTE1MTcyNn0.HlNIZFU2kq2-pyq0PgBxFX1Kg1iKldF_Y3thWKzYBnM";

// LOGIN
async function login() {
  const email = document.getElementById("email").value;
  const senha = document.getElementById("senha").value;

  const r = await fetch(
    `${SUPABASE_URL}/rest/v1/banco?email=eq.${email}&senha=eq.${senha}`,
    {
      headers: {
        apikey: SUPABASE_KEY,
        Authorization: "Bearer " + SUPABASE_KEY
      }
    }
  );

  const dados = await r.json();

  if (!dados.length) {
    alert("Login inv√°lido");
    return;
  }

  // gera cache no backend
  await fetch("/gerar-json");

  document.getElementById("login").style.display = "none";
  document.getElementById("app").style.display = "block";
}

// IA
async function enviar() {
  const texto = document.getElementById("cmd").value;

  const r = await fetch("/ia", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ texto })
  });

  const data = await r.json();
  document.getElementById("resp").textContent = data.resposta;
}
</script>

</body>
</html>
