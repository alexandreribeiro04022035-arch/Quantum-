<!DOCTYPE html>
<html lang="pt-BR">
    <!-- Deploy: ${new Date().toISOString()} -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Invest</title>

    <style> 
        body {
            background: #000;
            color: gold;
            font-family: Arial;
            padding: 20px;
            text-align: center;
        }

        .caixa {
            border: 1px solid gold;
            padding: 15px;
            border-radius: 10px;
            width: 330px;
            margin: auto;
            background: #111;
            box-shadow: 0 0 12px gold;
        }

        input {
            width: 90%;
            padding: 10px;
            margin: 8px;
            border-radius: 6px;
            border: 1px solid gold;
            background: #000;
            color: gold;
        }

        button {
            width: 90%;
            padding: 12px;
            margin-top: 10px;
            border-radius: 8px;
            border: 1px solid gold;
            background: #111;
            color: gold;
            cursor: pointer;
        }

        button:hover {
            background: gold;
            color: black;
        }

        .invisivel {
            display: none;
        }

        .titulo {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 0 0 12px gold;
        }

        .descri {
            margin-top: 35px;
            font-size: 14px;
            color: gold;
        }
    </style>
</head>

<body>

    <div class="titulo">Quantum Invest</div>

    <!-- LOGIN -->
    <div id="divLogin" class="caixa">
        <input id="emailLogin" placeholder="Email">
        <input id="senhaLogin" type="password" placeholder="Senha">

        <button id="btnEntrar">Entrar</button>
        <button id="btnCadastrar">Cadastrar</button>
        <button id="btnLimpar">Limpar campos</button>
        <button id="btnAjuda">Ajuda (Robô)</button>
    </div>

    <!-- MENSAGENS -->
    <div id="divMensagem" class="invisivel"></div>

    <!-- FORMULÁRIO DE CADASTRO (carregado via JS/Ajax) -->
    <div id="divCadastro" class="invisivel"></div>

    <!-- ROBÔ AJAX -->
    <div id="divRobo" class="invisivel"></div>

    <!-- PAINEL PRINCIPAL APÓS LOGIN -->
    <div id="divPainel" class="invisivel">

        <h2>Painel do Investidor</h2>

        <!-- BOTÕES QUE APONTAM PARA O ROBÔ -->
        <button class="acaoBtn" id="btnDepositar">Depositar</button>
        <button class="acaoBtn" id="btnSacar">Sacar</button>
        <button class="acaoBtn" id="btnAplicar">Aplicar CDB</button>
        <button class="acaoBtn" id="btnResgatar">Resgatar CDB</button>
        <button class="acaoBtn" id="btnComprar">Comprar Ações</button>
        <button class="acaoBtn" id="btnVender">Vender Ações</button>

        <br><br>

        <!-- BOTÕES DE EXTRATOS -->
        <button id="btnExtratoConta">Extrato Conta</button>
        <button id="btnExtratoCDB">Extrato CDB</button>
        <button id="btnExtratoAcao">Extrato Ação</button>
        <button id="btnHistorico">Histórico</button>

        <!-- ÁREA DE EXIBIÇÃO DOS EXTRATOS -->
        <div id="divExtrato" class="invisivel"></div>

        <!-- DADOS COMPLETOS DO CLIENTE -->
        <div id="divResumo" class="invisivel"></div>
    </div>

    <!-- DESCRIÇÃO FIXA -->
    <div class="descri">
        <b>Quantum Invest</b><br>
        Desenvolvido com IA — o futuro é agora!<br><br>

        Contato:<br>
        zozimofreitas3@gmail.com<br>
        fakegab01@gmail.com<br>
        WhatsApp: 21 99910-2951<br><br>

        Quem somos? Fintech Quantum Invest<br><br>

        © Alexandre Ribeiro, André Bonotto, ChatGPT5, DeepSeek, Gemini Google
    </div>

<script>
// ====================== CONFIGURAÇÃO SUPABASE ======================
const SUPABASE_URL = 'https://lpkhscatjrllfscqmxka.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxwa2hzY2F0anJsbGZzY3FteGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1NzU3MjYsImV4cCI6MjA3OTE1MTcyNn0.HlNIZFU2kq2-pyq0PgBxFX1Kg1iKldF_Y3thWKzYBnM';

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// ====================== ELEMENTOS ======================
let divLogin, divMensagem, divCadastro, divRobo, divPainel, divExtrato, divResumo;
let emailLogin, senhaLogin, btnEntrar, btnCadastrar, btnLimpar, btnAjuda;

// ====================== INICIALIZAÇÃO ======================
document.addEventListener('DOMContentLoaded', function() {
    inicializarElementos();
    inicializarApp();
});

function inicializarElementos() {
    // Elementos principais
    divLogin = document.getElementById("divLogin");
    divMensagem = document.getElementById("divMensagem");
    divCadastro = document.getElementById("divCadastro");
    divRobo = document.getElementById("divRobo");
    divPainel = document.getElementById("divPainel");
    divExtrato = document.getElementById("divExtrato");
    divResumo = document.getElementById("divResumo");

    // Inputs login
    emailLogin = document.getElementById("emailLogin");
    senhaLogin = document.getElementById("senhaLogin");

    // Botões login
    btnEntrar = document.getElementById("btnEntrar");
    btnCadastrar = document.getElementById("btnCadastrar");
    btnLimpar = document.getElementById("btnLimpar");
    btnAjuda = document.getElementById("btnAjuda");

    configurarEventListeners();
}

async function inicializarApp() {
    // Verifica se usuário já está logado
    const { data: { user } } = await supabase.auth.getUser();
    if (user) {
        esconderDiv(divLogin);
        mostrarDiv(divPainel);
        carregarResumo(user.id);
    }
}

function configurarEventListeners() {
    // Botões login
    btnEntrar.addEventListener('click', fazerLogin);
    btnCadastrar.addEventListener('click', abrirCadastro);
    btnLimpar.addEventListener('click', limparCampos);
    btnAjuda.addEventListener('click', () => carregarRobot('ajuda'));

    // Botões do painel
    const acoes = ["Depositar", "Sacar", "Aplicar", "Resgatar", "Comprar", "Vender"];
    acoes.forEach(acao => {
        const btn = document.getElementById("btn" + acao);
        if (btn) btn.addEventListener('click', () => carregarRobot(acao.toLowerCase()));
    });

    // Botões de extrato
    document.getElementById("btnExtratoConta").addEventListener('click', () => carregarExtrato("extratoconta"));
    document.getElementById("btnExtratoCDB").addEventListener('click', () => carregarExtrato("extrtatocdb"));
    document.getElementById("btnExtratoAcao").addEventListener('click', () => carregarExtrato("extratoacao"));
    document.getElementById("btnHistorico").addEventListener('click', () => carregarExtrato("hitorico"));
}

// ====================== UTILIDADES ======================
function mostrarMensagem(msg) {
    divMensagem.classList.remove("invisivel");
    divMensagem.innerText = msg;
    setTimeout(() => {
        divMensagem.classList.add("invisivel");
        divMensagem.innerText = "";
    }, 4000);
}

function mostrarDiv(div) {
    div.classList.remove("invisivel");
}

function esconderDiv(div) {
    div.classList.add("invisivel");
}

// ====================== LOGIN ======================
async function fazerLogin() {
    const email = emailLogin.value.trim();
    const senha = senhaLogin.value.trim();
    
    if (!email || !senha) {
        mostrarMensagem("Preencha todos os campos!");
        return;
    }

    const { data, error } = await supabase.auth.signInWithPassword({ 
        email: email, 
        password: senha 
    });
    
    if (error) {
        mostrarMensagem(error.message);
        return;
    }

    mostrarMensagem("Login realizado com sucesso!");
    esconderDiv(divLogin);
    mostrarDiv(divPainel);
    carregarResumo(data.user.id);
}

// ====================== LIMPAR ======================
function limparCampos() {
    emailLogin.value = "";
    senhaLogin.value = "";
    mostrarMensagem("Campos limpos! Use para logar ou cadastrar.");
}

// ====================== CADASTRO ======================
function abrirCadastro() {
    divCadastro.innerHTML = `
        <div class="caixa">
            <input id="nomeCad" placeholder="Nome">
            <input id="cpfCad" placeholder="CPF">
            <input id="emailCad" placeholder="Email">
            <input id="telefoneCad" placeholder="Telefone">
            <input id="senhaCad" type="password" placeholder="Senha">
            <button id="btnEnviarCadastro">Enviar Cadastro</button>
        </div>
    `;
    mostrarDiv(divCadastro);

    document.getElementById("btnEnviarCadastro").addEventListener('click', enviarCadastro);
}

async function enviarCadastro() {
    const nome = document.getElementById("nomeCad").value.trim();
    const cpf = document.getElementById("cpfCad").value.trim();
    const email = document.getElementById("emailCad").value.trim();
    const telefone = document.getElementById("telefoneCad").value.trim();
    const senha = document.getElementById("senhaCad").value.trim();

    if (!nome || !cpf || !email || !telefone || !senha) {
        mostrarMensagem("Preencha todos os campos do cadastro!");
        return;
    }

    const { data: authData, error: authError } = await supabase.auth.signUp({ 
        email: email, 
        password: senha 
    });
    
    if (authError) {
        mostrarMensagem(authError.message);
        return;
    }

    // Inserir dados iniciais na tabela banco
    const { data, error: dbError } = await supabase.from("banco").insert([{
        nome, cpf, email, telefone, senha,
        poupanca: 0, depositar: 0, sacar: 0, saldo: 0,
        aplicar: 0, resgatar: 0, rendimento: 0, lucro: 0,
        capital: 0, montante: 0, cota: 0, credito: 0, debito: 0, limite: 0
    }]);

    if (dbError) {
        mostrarMensagem(dbError.message);
        return;
    }

    mostrarMensagem("Cadastro realizado com sucesso!");
    esconderDiv(divCadastro);
}

// ====================== ROBÔ (AJAX) ======================
async function carregarRobot(acao) {
    // Exibe robot
    const { data: { user } } = await supabase.auth.getUser();
    const userEmail = user ? user.email : '';
    
    divRobo.innerHTML = `
        <div class="caixa">
            <input id="robotNome" value="${userEmail}" readonly>
            <input id="robotMensagem" value="Requisição de ${acao}" readonly>
            <button id="btnEnviarRobot">Enviar</button>
        </div>
    `;
    mostrarDiv(divRobo);

    document.getElementById("btnEnviarRobot").addEventListener('click', async () => {
        const nome = document.getElementById("robotNome").value;
        const msg = document.getElementById("robotMensagem").value;

        const { data, error } = await supabase.from("banco").update({
            mensagem: msg
        }).eq("email", nome);

        if (error) {
            mostrarMensagem("Erro ao enviar requisição!");
            return;
        }

        mostrarMensagem(`Requisição de ${acao} recebida; aguarde atendente`);
    });
}

// ====================== EXTRATOS ======================
async function carregarExtrato(campo) {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) return;

    const { data, error } = await supabase.from("banco").select("*").eq("email", user.email).single();
    if (error) {
        mostrarMensagem(error.message);
        return;
    }

    let html = `<div class="caixa"><h3>${campo}</h3>`;
    html += `<pre>${JSON.stringify(data[campo], null, 2)}</pre></div>`;
    divExtrato.innerHTML = html;
    mostrarDiv(divExtrato);
}

// ====================== RESUMO DO CLIENTE ======================
async function carregarResumo(userId) {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) return;

    const { data, error } = await supabase.from("banco").select("*").eq("email", user.email).single();
    if (error) {
        mostrarMensagem(error.message);
        return;
    }

    let html = `<div class="caixa"><h3>Resumo do Cliente</h3>`;
    html += `<p>Nome: ${data.nome}</p>`;
    html += `<p>Email: ${data.email}</p>`;
    html += `<p>Telefone: ${data.telefone}</p>`;
    html += `<p>Saldo: ${data.saldo}</p>`;
    html += `<p>Poupança: ${data.poupanca}</p>`;
    html += `<p>Aplicar: ${data.aplicar}</p>`;
    html += `<p>Resgatar: ${data.resgatar}</p>`;
    html += `<p>Capital ações: ${data.capital}</p>`;
    html += `<p>Montante ações: ${data.montante}</p>`;
    html += `<p>Cota: ${data.cota}%</p>`;
    html += `<p>Limite cartão: ${data.limite}</p>`;
    html += `<p>Crédito: ${data.credito}</p>`;
    html += `<p>Débito: ${data.debito}</p>`;
    html += `</div>`;

    divResumo.innerHTML = html;
    mostrarDiv(divResumo);
}
</script>
</body>
</html>
